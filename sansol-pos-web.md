# Project Plan: SansolPos Web
Slug: `sansol-pos-web`

## Overview
A new multi-tenant POS web application exclusively for the "Sansol" store, replacing Loyverse. It handles products, inventory, sales (with a checkout module), receipt generation structurally ready for AFIP (with WhatsApp sending capabilities), expenses, and an automated analytics dashboard. It exposes an API/Webhooks for n8n integration. 

## Project Type
WEB

## Success Criteria
- [ ] Multi-tenant isolation is strictly enforced (all data tied to `store_id`).
- [ ] Cashier POS interface works quickly using a cart-based system.
- [ ] Checkout successfully captures payment method and phone number and outputs an AFIP-ready internal receipt.
- [ ] Stock quantities decrement automatically on sale.
- [ ] Products can be imported via an Excel/CSV template.
- [ ] n8n integrations can retrieve data via secured API endpoints.
- [ ] Comprehensive Markdown documentation generated by notebooklm agent.
- [ ] QA verifies multi-tenant boundaries and core POS flows. 

## Tech Stack
- **Frontend & API**: Next.js (App Router), React, Tailwind CSS (for UI and the POS layout).
- **Backend/Database**: Supabase (Postgres with Row Level Security for Multi-tenancy, Auth).
- **Receipts**: HTML to PDF generation libraries (e.g. `react-to-pdf` or backend standard).
- **Testing**: Playwright for E2E, Vitest for unit tests. 

## File Structure
```
/
├── scr/
│   ├── app/ (Next.js Pages & API Routes)
│   ├── components/
│   │   ├── pos/ (Checkout, Cart, Product Grid)
│   │   ├── dashboard/ (Analytics, Stats)
│   │   └── shared/ (Receipts, Layout)
│   ├── lib/ (Supabase client, utils)
│   └── types/ (TypeScript definitions)
├── supabase/
│   ├── migrations/ (Database schema)
│   └── seed.sql
└── docs/ (NotebookLM Markdown outputs)
```

## Task Breakdown

### Phase 1: Arquitectura
- **Task**: Initialize Next.js project, Configure Supabase, setup folder structure.
- **Agent**: `orchestrator` & `backend-specialist`
- **INPUT→OUTPUT→VERIFY**: Input: empty repo → Output: Next.js + Supabase running → Verify: app loads and connects to DB.

### Phase 2: Modelo de datos
- **Task**: Implement Supabase schemas for `organizations`, `stores`, `users` (multi-tenant RLS), `products`, `categories`, `sales`, `sale_items`, `stock_movements`, `expenses`. Ensure all required AFIP fields are created.
- **Agent**: `database-architect`
- **INPUT→OUTPUT→VERIFY**: Input: Schema requirements → Output: Migration files → Verify: Run `.agent/scripts/schema_validator.py` or inspect DB.

### Phase 3: Diseño Comprobante AFIP-ready
- **Task**: Design the visual HTML/CSS receipt template containing specific required fields (Logo, CUIT, Fiscal Address, QR, Items, Totals) in thermal and A4 formats.
- **Agent**: `frontend-specialist`
- **INPUT→OUTPUT→VERIFY**: Input: Fake sale data → Output: Rendered Receipt component → Verify: Looks like an AFIP ticket.

### Phase 4: Documentación inicial
- **Task**: Create structural and technical specs (Technical docs, integration manual, deployment manual).
- **Agent**: `notebooklm` (or `documentation-writer`)
- **INPUT→OUTPUT→VERIFY**: Input: Current plan → Output: `docs/technical.md`, etc. → Verify: Markdown files exist.

### Phase 5: MVP Implementation
- **5.1 Auth & Settings**: Implement auth and store selector.
- **5.2 Products Management**: CRUD + Import template Excel/CSV logic.
- **5.3 POS UI**: The cashier interface (thumbnails, stock live indicators, cart subtotal).
- **5.4 Checkout Process**: Payment forms, Whatsapp integration (`wa.me` links), stock reduction logic.
- **5.5 Expenses**: ABM for expenses with categories.
- **5.6 Dashboard**: Real-time stats, filtering by store/month limit.
- **5.7 API & Webhooks**: Ensure API endpoints required for n8n exist and are secured via custom API Keys.
- **Agents**: `frontend-specialist` & `backend-specialist`
- **INPUT→OUTPUT→VERIFY**: Input: DB and UI ready → Output: Functional workflows → Verify: Manual testing of each core flow.

### Phase 6: QA
- **Task**: Run multi-tenant leakage tests, checkout flows, and security scans.
- **Agent**: `qa-automation-engineer` & `security-auditor`
- **INPUT→OUTPUT→VERIFY**: Input: Complete MVP → Output: Passing tests → Verify: `test_runner.py` and `security_scan.py` succeed.

### Phase 7: Documentación final
- **Task**: Update Markdown documentation to reflect final data models and flows.
- **Agent**: `notebooklm`
- **INPUT→OUTPUT→VERIFY**: Input: Finished MVP → Output: Final `docs/*.md` → Verify: Exportable to PDF requirements met.

## Phase X: Verification Checkout
- [ ] Run Lint & Type checks
- [ ] Run Security Scanner
- [ ] Run full UI tests
- [ ] Build Next.js
- [ ] Socratic Gate was respected
- [ ] No purple hex codes used (per global rules)
